<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Minty-Commerce | Cadastro</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <h2>Cadastro de Item</h2>
  <form id="itemForm">
    <label>
      Nome: <input type="text" name="name" required>
    </label><br><br>
    <label>
      Descrição: <input type="text" name="description" required>
    </label><br><br>
    <label>
      Quantidade: <input type="number" name="qtd" required>
    </label><br><br>
    <label>
      Preço: <input type="number" step="0.01" name="price" required>
    </label><br><br>
    <button type="submit">Enviar</button>
  </form>

  <script>
    
    const form = document.getElementById("itemForm");
    function getQueryParam(param) {
      const urlParams = new URLSearchParams(window.location.search);
      return urlParams.get(param);
    }

    async function preencherFormularioPorID(id) {
      try {
        const response = await fetch('/mockdata/products.json');
        const data = await response.json();

        const produto = data.products.find(p => p.id === parseInt(id));

        if (produto) {
          form.name.value = produto.name;
          form.description.value = produto.description;
          form.qtd.value = produto.qtd;
          form.price.value = produto.price;
        }
      } catch (error) {
        console.error("Erro ao carregar produtos:", error);
      }
    }

    const idQuery = getQueryParam("product");
    
    preencherFormularioPorID(parseInt(idQuery));

    form.addEventListener("submit", async function(event) {
      event.preventDefault();

      const data = {
        name: form.name.value,
        description: form.description.value,
        qtd: parseInt(form.qtd.value),
        price: parseFloat(form.price.value)
      };

      const url = "/api/items"; // Substitua pelo seu endpoint real

      try {
        const response = await fetch(url, {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify(data)
        });

        if (response.ok) {
          alert("Item enviado com sucesso!");
          document.location = "/manage.html";
        } else {
          alert("Falha ao enviar o item. Código: " + response.status);
        }
      } catch (error) {
        console.error("Erro ao enviar item:", error);
        alert("Erro ao tentar enviar o item.");
      }
    });
  </script>
</body>
</html>
